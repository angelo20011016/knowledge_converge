# SaaS 服務部署計畫：Video Knowledge Convergence

本文件旨在為 "Video Knowledge Convergence" 專案提供一個從開發到正式上線的完整部署計畫，確保流程的標準化、安全性與可擴展性。

---

## 核心技術與策略重點

根據目前的開發方向，我們將專注於以下五個核心領域：

1.  **單一登入 (SSO) 整合:** 建立安全且無縫的使用者身份驗證機制，作為企業級服務的基礎。
2.  **使用者行為與存取記錄:** 使用 SQL 資料庫詳細記錄使用者操作與資料存取歷史，以供未來分析、稽核與安全監控。
3.  **全面的容器化 (Docker):** 將前端、後端及所有服務完全 Docker 化，實現環境一致性與快速部署。
4.  **嚴格的資源存取與釋放管理:** 確保雲端資源與應用程式內部資源（如資料庫連線、檔案處理）的存取安全及時釋放，防止資源洩漏。
5.  **完整的測試策略與測試檔案:** 建立並維護單元測試、整合測試與端對端測試，確保程式碼品質與系統穩定性。

---

## 階段 1：開發與預備環境建置 (Development & Staging)

此階段的目標是建立一個自動化的開發與測試流程。

1.  **容器化 (Dockerization):**
    *   **核心目標:** 將所有應用程式（後端 Python, 前端 React）與服務容器化。
    *   **後端 (Python):** 建立 `Dockerfile`，打包所有依賴。
    *   **前端 (React):** 使用多階段建置的 `Dockerfile`，最終由 `Nginx` 提供服務。
    *   **本地開發:** 撰寫 `docker-compose.yml`，一鍵啟動完整開發環境。

2.  **資料庫建置與使用者行為記錄:**
    *   **資料庫選擇:** 建議使用 `PostgreSQL`。
    *   **資料庫結構管理:** 使用 `Alembic` 進行資料庫遷移。
    *   **使用者操作記錄 (SQL Logging):**
        *   設計專門的資料表 (e.g., `user_actions_log`) 來記錄關鍵操作。
        *   記錄欄位應包含：`user_id`, `action_type` (e.g., 'LOGIN', 'VIDEO_SUBMIT', 'VIEW_SUMMARY'), `target_resource_id`, `timestamp`, `ip_address`。
        *   此記錄為後續的稽核、分析與安全監控提供基礎。

3.  **測試策略與測試檔案:**
    *   **單元測試 (Unit Tests):** 針對獨立的函式與模組編寫測試，確保其邏輯正確。測試檔案應與原始碼並存 (e.g., `module/test_module.py`)。
    *   **整合測試 (Integration Tests):** 測試多個模組協同工作的場景（如 API 端點與資料庫的互動）。
    *   **端對端測試 (E2E Tests):** (可選) 使用 `Cypress` 或 `Playwright` 等工具模擬使用者操作，測試完整的業務流程。
    *   所有測試檔案都應納入版本控制。

4.  **建立 CI/CD 管道 (CI/CD Pipeline):**
    *   使用 `GitHub Actions` 自動化測試與部署。
    *   **持續整合 (CI):** 在 `develop` 分支有提交時，自動執行程式碼風格檢查與所有**測試檔案**。
    *   **持續部署 (CD):** 成功合併到 `main` 分支後，自動建置 Docker Image 並部署到預備環境。

---

## 階段 2：生產環境準備 (Production Readiness)

此階段的目標是建置並加固生產環境。

1.  **使用者認證 (SSO):**
    *   **核心要求:** 整合企業級 SSO 解決方案 (如 Auth0, Okta, Google Workspace)。
    *   這將是使用者登入系統的唯一入口，需確保其安全性與可靠性。

2.  **資源存取管理 (Resource Access Management):**
    *   **雲端層級:** 使用 IAM (Identity and Access Management) 最小權限原則，嚴格限制每個服務（如後端容器、CI/CD 管道）對其他雲端資源（如資料庫、儲存桶）的存取權限。
    *   **應用層級:** 確保資料庫連線池的正確配置與管理，處理檔案後及時關閉檔案描述符，防止資源洩漏。

3.  **日誌、監控與警報系統:**
    *   **日誌 (Logging):** 集中管理應用程式日誌與**使用者操作記錄**。
    *   **監控 (Monitoring):** 建立儀表板監控關鍵效能指標 (CPU, 記憶體, API 回應時間)。
    *   **警報 (Alerting):** 設定關鍵指標的警報規則。

4.  **基礎設施與安全:**
    *   使用 IaC (Terraform) 腳本建立與預備環境隔離的生產環境。
    *   設定網域、DNS 與強制 HTTPS。

5.  **備份與還原計畫:**
    *   設定資料庫的每日自動備份並**定期演練還原**。

---

## 階段 3：上線 (Go-Live)

1.  **部署到生產環境:** 將 `main` 分支的最新版本部署到生產環境。
2.  **最終驗證 (Smoke Test):** 在生產環境手動測試核心功能。
3.  **正式啟用:** 更新 DNS，將流量導向生產環境。

---

## 階段 4：上線後維運 (Post-Launch Maintenance)

1.  **持續監控與資源優化:**
    *   密切關注監控儀表板，特別是資源使用率。
    *   根據監控數據，預先規劃擴展策略 (Auto-Scaling)，並對非同步任務的資源消耗進行優化。
2.  **定期維護:** 定期更新依賴套件與修補安全漏洞。
3.  **迭代開發:** 新功能遵循已建立的 CI/CD 流程與測試策略。